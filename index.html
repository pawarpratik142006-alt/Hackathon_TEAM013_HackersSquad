<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>National E-Voting Portal | India</title>
    <style>
        /* --- CORE VARIABLES & THEME --- */
        :root {
            --primary-navy: #000080;
            --saffron: #FF9933;
            --white: #FFFFFF;
            --green: #138808;
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
            --shadow-soft: 0 10px 25px rgba(0,0,0,0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--bg-gradient);
            color: var(--text-dark);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- HEADER & ANIMATED FLAG --- */
        header {
            width: 100%;
            background: var(--white);
            padding: 20px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            text-align: center;
            border-bottom: 6px solid var(--primary-navy);
            position: relative;
            z-index: 10;
        }

        .flag-wrapper {
            width: 75px;
            height: 50px;
            margin: 0 auto 15px auto;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            animation: gentle-wave 4s ease-in-out infinite alternate;
            transform-origin: bottom left;
        }

        .stripe { width: 100%; height: 33.33%; display: flex; justify-content: center; align-items: center; }
        .bg-saffron { background-color: var(--saffron); }
        .bg-white { background-color: var(--white); position: relative;}
        .bg-green { background-color: var(--green); }
        
        .ashoka-chakra {
            height: 14px;
            width: 14px;
            border: 1px solid var(--primary-navy);
            border-radius: 50%;
            animation: spin 6s linear infinite;
        }

        @keyframes gentle-wave {
            0% { transform: rotate(0deg) skewY(0deg); }
            100% { transform: rotate(2deg) skewY(-2deg); }
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        header h1 {
            color: var(--primary-navy);
            font-size: 24px;
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        header p {
            color: var(--text-light);
            font-size: 14px;
            font-weight: 500;
        }

        /* --- MAIN CONTAINER & CARDS --- */
        .main-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            padding: 20px;
        }

        .card {
            background: var(--white);
            width: 100%;
            max-width: 480px;
            border-radius: 12px;
            box-shadow: var(--shadow-soft);
            overflow: hidden;
            position: relative;
        }

        .card-header {
            background: var(--primary-navy);
            color: var(--white);
            padding: 20px;
            text-align: center;
            font-size: 18px;
            font-weight: 600;
        }

        .card-body {
            padding: 30px;
            text-align: center;
        }

        /* --- FORM ELEMENTS --- */
        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-dark);
            font-size: 14px;
        }

        input[type="text"] {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            text-transform: uppercase;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--primary-navy);
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary { background: var(--primary-navy); color: var(--white); }
        .btn-primary:hover { background: #000050; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,128,0.3); }
        
        .btn-outline { background: transparent; color: var(--text-light); border: 2px solid #ddd; margin-top: 10px;}
        .btn-outline:hover { background: #f8f9fa; color: var(--text-dark); border-color: #ccc; }

        #error-message {
            color: #d32f2f;
            background: #ffebee;
            padding: 10px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 14px;
            font-weight: 600;
            display: none;
        }

        /* --- VOTER INFO & BALLOT --- */
        .info-box {
            background: #f8f9fa;
            border-left: 4px solid var(--primary-navy);
            padding: 15px;
            border-radius: 4px;
            text-align: left;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .candidate-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border: 2px solid #eee;
            border-radius: 8px;
            margin-bottom: 15px;
            transition: border-color 0.3s;
        }

        .candidate-card:hover { border-color: var(--primary-navy); }
        
        .candidate-info { text-align: left; }
        .candidate-info h4 { margin: 0 0 5px 0; font-size: 18px; color: var(--text-dark); }
        .candidate-info p { margin: 0; font-size: 12px; color: var(--text-light); }
        
        .btn-vote { width: auto; padding: 10px 25px; font-size: 14px; border-radius: 30px; color: var(--white); }
        .bg-saffron-btn { background-color: var(--saffron); }
        .bg-saffron-btn:hover { background-color: #e68a00; transform: scale(1.05); }
        .bg-green-btn { background-color: var(--green); }
        .bg-green-btn:hover { background-color: #0f6c06; transform: scale(1.05); }

        /* --- SUCCESS SCREEN --- */
        .success-icon {
            font-size: 60px;
            color: var(--green);
            margin-bottom: 15px;
            animation: pop-in 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        /* --- UTILITIES & ANIMATIONS --- */
        .hidden { display: none !important; }
        
        .animate-slide-up { animation: slide-up 0.5s ease-out forwards; }
        
        @keyframes slide-up {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pop-in {
            0% { transform: scale(0); }
            80% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* --- FOOTER --- */
        footer {
            padding: 15px;
            text-align: center;
            font-size: 12px;
            color: var(--text-light);
            width: 100%;
        }
    </style>
</head>
<body>

    <header>
        <div class="flag-wrapper">
            <div class="stripe bg-saffron"></div>
            <div class="stripe bg-white"><div class="ashoka-chakra"></div></div>
            <div class="stripe bg-green"></div>
        </div>
        <h1>Election Commission</h1>
        <p>National Secure E-Voting Portal</p>
    </header>

    <div class="main-container">
        
        <div class="card animate-slide-up" id="view-login">
            <div class="card-header">Voter Authentication</div>
            <div class="card-body">
                <p style="margin-bottom: 25px; color: var(--text-light); font-size: 14px;">
                    Please enter your government-issued EPIC / Voter ID number to access the secure ballot.
                </p>
                <div class="input-group">
                    <label for="voter-id-input">EPIC / Voter ID Number</label>
                    <input type="text" id="voter-id-input" placeholder="e.g. EPIC101" autocomplete="off">
                </div>
                <button class="btn btn-primary" onclick="verifyVoter()">Verify Identity</button>
                <div id="error-message"></div>
                
                <p style="margin-top: 20px; font-size: 12px; color: #999;">
                    Test IDs: EPIC101, EPIC102, EPIC103
                </p>
            </div>
        </div>

        <div class="card hidden" id="view-details">
            <div class="card-header">Confirm Your Details</div>
            <div class="card-body">
                <div class="info-box" id="voter-details-box">
                    </div>
                <p style="font-size: 14px; margin-bottom: 20px; color: #e74c3c; font-weight: bold;">
                    Are these details correct?
                </p>
                <button class="btn btn-primary" onclick="switchView('view-details', 'view-ballot')">Yes, Proceed to Ballot</button>
                <button class="btn btn-outline" onclick="resetSystem()">No, Cancel</button>
            </div>
        </div>

        <div class="card hidden" id="view-ballot">
            <div class="card-header">Official Electronic Ballot</div>
            <div class="card-body">
                <p style="margin-bottom: 20px; font-size: 14px;">Select your preferred candidate. <br><strong>This action is final and irreversible.</strong></p>
                
                <div class="candidate-card">
                    <div class="candidate-info">
                        <h4>National Progress Party</h4>
                        <p>Candidate: A. Sharma</p>
                    </div>
                    <button class="btn btn-vote bg-saffron-btn" onclick="castVote('National Progress Party')">VOTE</button>
                </div>

                <div class="candidate-card">
                    <div class="candidate-info">
                        <h4>United Development Front</h4>
                        <p>Candidate: M. Singh</p>
                    </div>
                    <button class="btn btn-vote bg-green-btn" onclick="castVote('United Development Front')">VOTE</button>
                </div>
            </div>
        </div>

        <div class="card hidden" id="view-success">
            <div class="card-body" style="padding: 50px 30px;">
                <div class="success-icon">✓</div>
                <h2 style="color: var(--green); margin-bottom: 10px;">Vote Registered</h2>
                <p style="color: var(--text-dark); margin-bottom: 20px;">Your democratic choice has been securely recorded.</p>
                <p style="font-size: 13px; color: var(--text-light); background: #f1f2f6; padding: 10px; border-radius: 6px;">
                    A highly secure confirmation file has been downloaded to your device.
                </p>
                <p style="margin-top: 30px; font-size: 14px; font-weight: bold; color: var(--primary-navy); animation: pulse 2s infinite;">
                    Securing session and logging out...
                </p>
            </div>
        </div>

    </div>

    <footer>
        © 2024 Secure Voting Prototype | Protected by End-to-End Encryption
    </footer>

    <script>
        // --- SECURE MOCK DATABASE ---
        // In reality, this lives on an encrypted backend server.
        const database = {
            "EPIC101": { name: "Aarav Sharma", age: 32, constituency: "New Delhi", state: "Delhi" },
            "EPIC102": { name: "Diya Patel", age: 28, constituency: "Mumbai South", state: "Maharashtra" },
            "EPIC103": { name: "Rohan Iyer", age: 45, constituency: "Chennai Central", state: "Tamil Nadu" }
        };

        // --- STATE MANAGEMENT ---
        let currentActiveID = null;
        let localVoteTally = JSON.parse(localStorage.getItem('EciVoteTally')) || {};
        let localVotedList = JSON.parse(localStorage.getItem('EciVotedUsers')) || [];

        // --- CORE FUNCTIONS ---

        function showError(message) {
            const errDiv = document.getElementById('error-message');
            errDiv.innerText = "⚠ " + message;
            errDiv.style.display = 'block';
            
            // Shake animation for error
            const card = document.getElementById('view-login');
            card.style.transform = 'translateX(0)';
            card.animate([
                { transform: 'translateX(-10px)' },
                { transform: 'translateX(10px)' },
                { transform: 'translateX(-10px)' },
                { transform: 'translateX(0)' }
            ], { duration: 300, easing: 'ease-in-out' });
        }

        function verifyVoter() {
            const inputEl = document.getElementById('voter-id-input');
            const epicID = inputEl.value.trim().toUpperCase();
            document.getElementById('error-message').style.display = 'none';

            if (epicID === "") {
                showError("Please enter your Voter ID.");
                return;
            }

            // 1. Check if ID exists in database
            if (!database.hasOwnProperty(epicID)) {
                showError("Invalid Voter ID. Not found in electoral rolls.");
                return;
            }

            // 2. Check if already voted (Duplicate prevention)
            if (localVotedList.includes(epicID)) {
                showError("SECURITY ALERT: A vote has already been cast using this ID.");
                return;
            }

            // Verification Passed!
            currentActiveID = epicID;
            const user = database[epicID];
            
            // Populate UI
            document.getElementById('voter-details-box').innerHTML = `
                <div style="margin-bottom: 8px;"><strong>Full Name:</strong> ${user.name}</div>
                <div style="margin-bottom: 8px;"><strong>Age:</strong> ${user.age} Years</div>
                <div style="margin-bottom: 8px;"><strong>State:</strong> ${user.state}</div>
                <div><strong>Constituency:</strong> ${user.constituency}</div>
            `;

            switchView('view-login', 'view-details');
        }

        function castVote(partyName) {
            // Final security check before committing
            if (!currentActiveID || localVotedList.includes(currentActiveID)) {
                alert("Critical Security Error. Session terminated.");
                resetSystem();
                return;
            }

            // 1. Record Vote
            if (!localVoteTally[partyName]) localVoteTally[partyName] = 0;
            localVoteTally[partyName] += 1;

            // 2. Mark User as Voted
            localVotedList.push(currentActiveID);

            // 3. Save to LocalStorage (Persistent)
            localStorage.setItem('EciVoteTally', JSON.stringify(localVoteTally));
            localStorage.setItem('EciVotedUsers', JSON.stringify(localVotedList));

            // 4. Trigger File Download
            generateVotingReceipt();

            // 5. Show Success Screen
            switchView('view-ballot', 'view-success');

            // 6. Secure Auto-Logout mechanism (3 seconds)
            setTimeout(() => {
                resetSystem();
            }, 3500);
        }

        function generateVotingReceipt() {
            // Creates a clean, formatted text file summarizing the current state
            const report = {
                timestamp: new Date().toLocaleString(),
                totalVotesCast: localVotedList.length,
                results: localVoteTally,
                integrityCheck: "VALID - NO TAMPERING DETECTED"
            };

            const dataStr = JSON.stringify(report, null, 2);
            const blob = new Blob([dataStr], { type: "text/plain" });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `Election_Data_${new Date().getTime()}.txt`;
            document.body.appendChild(a);
            a.click();
            
            // Cleanup
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 0);
        }

        function switchView(hideId, showId) {
            document.getElementById(hideId).classList.add('hidden');
            
            const showEl = document.getElementById(showId);
            showEl.classList.remove('hidden');
            
            // Re-trigger animation
            showEl.classList.remove('animate-slide-up');
            void showEl.offsetWidth; // Force reflow
            showEl.classList.add('animate-slide-up');
        }

        function resetSystem() {
            currentActiveID = null;
            document.getElementById('voter-id-input').value = '';
            document.getElementById('error-message').style.display = 'none';
            
            document.getElementById('view-details').classList.add('hidden');
            document.getElementById('view-ballot').classList.add('hidden');
            document.getElementById('view-success').classList.add('hidden');
            
            switchView('view-success', 'view-login'); // In case it was on success screen
            document.getElementById('view-login').classList.remove('hidden'); // Ensure login is visible
        }

    </script>
</body>
</html>